name: Test

on: push

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          lfs: true

      - name: Set up Go
        uses: actions/setup-go@v1
        with:
          go-version: 1.22.x

      - name: Set up Python
        uses: actions/setup-python@v1
        with:
          python-version: '3.11'

      - name: Set up OpenJDKv22
        uses: actions/setup-java@v2
        with:
          java-version: '22'
          distribution: 'adopt'

      - name: Set up Dart
        uses: dart-lang/setup-dart@v1
        with:
          sdk: 2.19.6
        run: dart --version
        run: make get

      - name: Compile jlox
        run: cd craftinginterpreters && make java_chapters && cd ..

      - run: make test
